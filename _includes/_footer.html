
    <script>
let searchData = [];
let isSearchDataLoaded = false;

// Function to extract search data from all pages
async function loadSearchData() {
    if (isSearchDataLoaded) return;
    
    try {
        // Get all links from the current page to discover other pages
        const links = Array.from(document.querySelectorAll('a[href]'))
            .map(link => link.href)
            .filter(href => {
                // Filter for internal pages only
                return href.includes(window.location.origin) && 
                       !href.includes('#') && 
                       !href.includes('mailto:') && 
                       !href.includes('tel:') &&
                       !href.includes('.pdf') &&
                       !href.includes('.jpg') &&
                       !href.includes('.png');
            })
            .filter((href, index, arr) => arr.indexOf(href) === index); // Remove duplicates

        // Add current page
        links.unshift(window.location.href);

        // Extract data from each page
        const promises = links.slice(0, 20).map(async (url) => { // Limit to 20 pages for performance
            try {
                const response = await fetch(url);
                if (!response.ok) return null;
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extract meta information
                const title = doc.querySelector('title')?.textContent?.trim() || 
                             doc.querySelector('meta[property="og:title"]')?.content?.trim() ||
                             doc.querySelector('h1')?.textContent?.trim() ||
                             'Untitled';
                
                const description = doc.querySelector('meta[name="description"]')?.content?.trim() ||
                                  doc.querySelector('meta[property="og:description"]')?.content?.trim() ||
                                  doc.querySelector('meta[name="twitter:description"]')?.content?.trim() ||
                                  doc.querySelector('p')?.textContent?.trim()?.substring(0, 150) ||
                                  'No description available';
                
                const keywords = doc.querySelector('meta[name="keywords"]')?.content?.trim() || '';
                
                // Try to determine category from URL or content
                let category = 'page';
                const urlLower = url.toLowerCase();
                if (urlLower.includes('event')) category = 'events';
                else if (urlLower.includes('workshop')) category = 'workshops';
                else if (urlLower.includes('tutorial')) category = 'tutorials';
                else if (urlLower.includes('volunteer')) category = 'volunteer';
                else if (urlLower.includes('newsletter')) category = 'newsletter';
                else if (urlLower.includes('community') || urlLower.includes('mailing')) category = 'community';
                else if (urlLower.includes('about')) category = 'about';
                else if (urlLower.includes('contact')) category = 'contact';
                
                // Extract date if available
                const dateElement = doc.querySelector('time[datetime]') || 
                                  doc.querySelector('.date') || 
                                  doc.querySelector('[class*="date"]');
                const date = dateElement?.getAttribute('datetime') || 
                           dateElement?.textContent?.trim() || '';

                return {
                    title: title,
                    subtitle: description,
                    category: category,
                    keywords: `${title} ${description} ${keywords}`.toLowerCase(),
                    url: url,
                    date: date
                };
            } catch (error) {
                console.warn('Error loading page:', url, error);
                return null;
            }
        });

        const results = await Promise.all(promises);
        searchData = results.filter(item => item !== null);
        
        // Add some default entries for common searches
        searchData.push(
            { title: "Linux Victoria Newsletter", subtitle: "Stay updated with our latest news and events", category: "newsletter", keywords: "newsletter updates news", url: "#newsletter" },
            { title: "Volunteer Opportunities", subtitle: "Help Linux Victoria grow and support the community", category: "volunteer", keywords: "volunteer help contribute community", url: "/volunteer-form" },
            { title: "Mailing Lists", subtitle: "Join our discussion forums and community conversations", category: "community", keywords: "mailing list discussion forum luv", url: "#mailing-lists" }
        );
        
        isSearchDataLoaded = true;
    } catch (error) {
        console.error('Error loading search data:', error);
        // Fallback to basic search data if loading fails
        searchData = [
            { title: "Linux Victoria Newsletter", subtitle: "Stay updated with our latest news", category: "newsletter", keywords: "newsletter updates news", url: "#newsletter" },
            { title: "Volunteer Opportunities", subtitle: "Help Linux Victoria grow", category: "volunteer", keywords: "volunteer help contribute community", url: "/volunteer-form" },
            { title: "Mailing Lists", subtitle: "Join our discussion forums", category: "community", keywords: "mailing list discussion forum luv", url: "#mailing-lists" }
        ];
        isSearchDataLoaded = true;
    }
}

function truncateText(text, maxLines = 2) {
    const maxChars = maxLines === 2 ? 120 : 60; // Approximate characters for 2 lines
    if (text.length <= maxChars) return text;
    return text.substring(0, maxChars).trim() + '...';
}

async function openSearch() {
    const modal = new bootstrap.Modal(document.getElementById('searchModal'));
    modal.show();
    
    // Show loading state
    document.getElementById('searchResults').innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted mt-2">Loading search data...</p>
        </div>`;
    
    // Load search data if not already loaded
    if (!isSearchDataLoaded) {
        await loadSearchData();
    }
    
    setTimeout(() => {
        document.getElementById('searchInput').focus();
        document.getElementById('searchResults').innerHTML = '<div class="text-muted text-center py-4"><i class="bi bi-search fs-1 d-block mb-3"></i>Start typing to search...</div>';
    }, 500);
}

function performSearch() {
    const query = document.getElementById('searchInput').value.toLowerCase().trim();
    const resultsContainer = document.getElementById('searchResults');
    
    if (query.length === 0) {
        resultsContainer.innerHTML = '<div class="text-muted text-center py-4"><i class="bi bi-search fs-1 d-block mb-3"></i>Start typing to search...</div>';
        return;
    }

    if (query.length < 2) {
        resultsContainer.innerHTML = '<div class="text-muted text-center py-4">Type at least 2 characters to search...</div>';
        return;
    }

    const results = searchData.filter(item => 
        item.keywords.includes(query) ||
        item.title.toLowerCase().includes(query) ||
        item.subtitle.toLowerCase().includes(query)
    ).slice(0, 10); // Limit to 10 results

    if (results.length === 0) {
        resultsContainer.innerHTML = `
            <div class="text-center py-4">
                <i class="bi bi-exclamation-circle text-warning fs-1 d-block mb-3"></i>
                <p class="text-muted">No results found for "${query}"</p>
                <small class="text-muted">Try different keywords or browse our events above</small>
            </div>`;
        return;
    }

    resultsContainer.innerHTML = results.map(item => `
        <div class="search-result-item border rounded-3 p-3 mb-2 bg-light hover-border-primary" 
             onclick="selectSearchResult('${item.url}')" style="cursor: pointer; transition: all 0.2s ease;">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <div class="d-flex align-items-center mb-1">
                        <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill px-2 py-1 small me-2">
                            ${item.category}
                        </span>
                        ${item.date ? `<small class="text-muted">${item.date}</small>` : ''}
                    </div>
                    <h6 class="mb-1 text-primary search-title" style="line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        ${truncateText(item.title, 2)}
                    </h6>
                    <p class="mb-0 text-muted small search-subtitle" style="line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        ${truncateText(item.subtitle, 2)}
                    </p>
                </div>
                <i class="bi bi-arrow-right text-primary ms-2" style="flex-shrink: 0;"></i>
            </div>
        </div>
    `).join('');
}

function selectSearchResult(url) {
    const modal = bootstrap.Modal.getInstance(document.getElementById('searchModal'));
    modal.hide();
    
    // Navigate to the URL
    if (url.startsWith('#')) {
        // Scroll to anchor on current page
        const element = document.querySelector(url);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth' });
        }
    } else {
        // Navigate to different page
        window.location.href = url;
    }
}

// Initialize search on modal show
document.getElementById('searchModal').addEventListener('shown.bs.modal', function () {
    document.getElementById('searchInput').focus();
    if (!isSearchDataLoaded) {
        document.getElementById('searchResults').innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted mt-2">Loading search data...</p>
            </div>`;
    } else {
        document.getElementById('searchResults').innerHTML = '<div class="text-muted text-center py-4"><i class="bi bi-search fs-1 d-block mb-3"></i>Start typing to search...</div>';
    }
});

// Clear search when modal is hidden
document.getElementById('searchModal').addEventListener('hidden.bs.modal', function () {
    document.getElementById('searchInput').value = '';
    if (isSearchDataLoaded) {
        document.getElementById('searchResults').innerHTML = '';
    }
});

// Preload search data when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Load search data in background after a short delay
    setTimeout(loadSearchData, 2000);
});
</script>

<footer class="bg-body-secondary container-fluid p-5 pb-3 text-center mt-5">
    <div class="row">
        <div class="col-12 mb-3">
            <span class="mb-1 text-secondary">Copyright &copy; <span id="year"></span> Linux Users of Victoria - All
                Rights
                Reserved
            </span>
        </div>
        <div class="col-12">
            <a href="https://github.com/LinuxVictoria/linux-victoria-website" target="_blank" class="text-primary">
                GitHub Repository
            </a>
        </div>
    </div>
</footer>

<script>

    document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>

</html>